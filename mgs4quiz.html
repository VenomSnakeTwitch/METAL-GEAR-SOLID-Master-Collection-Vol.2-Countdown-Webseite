<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MGS4 Quiz</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap');

html, body {
    margin:0; padding:0;
    font-family:'Orbitron', sans-serif;
    background: url("background.jpg") no-repeat center center fixed;
    background-size: cover;
    color: gold;
    text-align:center;
    overflow-x:hidden;
}

#overlay {
    background: rgba(0,0,0,0.85);
    min-height: 100vh;
    padding:20px;
    box-sizing:border-box;
}

h1 { font-size:36px; text-shadow: 0 0 15px gold,0 0 30px black; margin-bottom:20px; }

.question { font-size:24px; margin:20px 0 10px 0; }
.answers button {
    display:block; margin:10px auto; padding:10px 20px; font-size:16px;
    cursor:pointer; border:2px solid gold; background:black; color:gold; width:50%;
}
#nextButton { margin-top:20px; display:none; }
#timer { font-size:20px; margin-top:10px; }
#scoreBoard { display:none; margin-top:20px; }
input[type=text]{ padding:8px; font-size:16px; width:200px; }

@keyframes blinkGreen {
  0%,100%{background-color:green;}
  50%{background-color:white;}
}
@keyframes blinkRed {
  0%,100%{background-color:red;}
  50%{background-color:white;}
}
button.correct { animation: blinkGreen 0.6s ease 1; color:white; border-color:green;}
button.wrong { animation: blinkRed 0.6s ease 1; color:white; border-color:red;}
button:hover { background:gold; color:black; }

</style>
</head>
<body>
<div id="overlay">
<h1>MGS4 Quiz</h1>

<div id="difficultySelection">
    <p>Wähle Schwierigkeitsgrad:</p>
    <button onclick="startQuiz('easy')">Easy</button>
    <button onclick="startQuiz('medium')">Medium</button>
    <button onclick="startQuiz('hard')">Hard</button>
</div>

<div id="quizContainer" style="display:none;">
    <div id="timer">⏱ 30s</div>
    <div id="questionContainer"></div>
    <div class="answers" id="answersContainer"></div>
    <button id="nextButton" onclick="nextQuestion()">▶ Nächste Frage</button>
</div>

<div id="scoreBoard">
    <h2>Quiz beendet!</h2>
    <p>Deine Punktzahl: <span id="finalScore"></span></p>
    <p>Trage deinen Namen ein:</p>
    <input type="text" id="playerName" placeholder="Name">
    <button onclick="saveScoreServer()">✔ Speichern</button>
    <h3>Highscore-Liste</h3>
    <ul id="leaderBoard"></ul>
    <br>
    <button onclick="goBack()">← Zurück zur Hauptseite</button>
</div>

<audio id="bgMusic" loop autoplay>
    <source src="music.mp3" type="audio/mpeg">
</audio>
</div>

<script>
// Musik
const audio = document.getElementById("bgMusic"); audio.volume=0.3;
document.addEventListener("click", ()=>{ audio.play().catch(()=>{}); }, {once:true});

// Fragenpool mit Difficulty
const questionPool = [
  {q:"Wer ist der Protagonist?", a:["Solid Snake","Raiden","Big Boss","Revolver Ocelot"], correct:0, difficulty:"easy"},
  {q:"Codename Snake?", a:["Old Snake","Liquid Snake","Naked Snake","Venom Snake"], correct:0, difficulty:"easy"},
  {q:"Jahr des Spiels?", a:["2014","2010","2012","2018"], correct:0, difficulty:"medium"},
  {q:"Organisation Feind?", a:["The Patriots","FOXHOUND","Diamond Dogs","Outer Heaven"], correct:0, difficulty:"medium"},
  {q:"Snakes Mentor?", a:["Otacon","Vulcan Raven","Liquid","Psycho Mantis"], correct:0, difficulty:"easy"},
  {q:"Snakes medizinisches Problem?", a:["Beschleunigtes Altern","Blindheit","Gehirnerschütterung","Memory Loss"], correct:0, difficulty:"hard"},
  {q:"Waffe oft genutzt?", a:["SOCOM","AK74","M16","FAMAS"], correct:0, difficulty:"easy"},
  {q:"Dead Cell Leader?", a:["Liquid Ocelot","Sniper Wolf","Big Boss","Revolver Ocelot"], correct:0, difficulty:"hard"},
  {q:"Welche Figur nutzt Stealth Suit?", a:["Snake","Otacon","Meryl","Liquid"], correct:0, difficulty:"medium"},
  {q:"Snake hilft wer technologisch?", a:["Otacon","Campbell","Meryl","Liquid"], correct:0, difficulty:"easy"}
  // ... hier können alle 100 Fragen eingetragen werden
];

// Variablen
let questions = [], currentQuestion=0, score=0, timeLeft=30, timer, difficulty="easy";
const questionContainer=document.getElementById("questionContainer");
const answersContainer=document.getElementById("answersContainer");
const nextButton=document.getElementById("nextButton");
const quizContainer=document.getElementById("quizContainer");
const scoreBoard=document.getElementById("scoreBoard");
const timerDisplay=document.getElementById("timer");

// Quiz starten
function startQuiz(level){
    difficulty=level;
    document.getElementById("difficultySelection").style.display="none";
    quizContainer.style.display="block";
    score=0; currentQuestion=0;
    questions=shuffleArray(questionPool.filter(q=>q.difficulty===difficulty)).slice(0,20);
    showQuestion();
}

// Timer
function startTimer(){
    clearInterval(timer);
    timeLeft=30;
    timerDisplay.textContent=`⏱ ${timeLeft}s`;
    timer=setInterval(()=>{
        timeLeft--;
        timerDisplay.textContent=`⏱ ${timeLeft}s`;
        if(timeLeft<=0){ clearInterval(timer); markTimeOut(); }
    },1000);
}

function markTimeOut(){
    const buttons = answersContainer.querySelectorAll("button");
    buttons.forEach(btn=>btn.disabled=true);
    buttons.forEach(btn=>{
        if(btn.dataset.correct==="true") btn.classList.add("correct");
    });
    nextButton.style.display="inline-block";
}

// Frage anzeigen
function showQuestion(){
    startTimer();
    const q=questions[currentQuestion];
    questionContainer.innerHTML=`<div class="question">${q.q}</div>`;
    answersContainer.innerHTML="";
    const answers=q.a.map((text,index)=>({text:index===q.correct?text:text, correct:index===q.correct}));
    const shuffledAnswers=shuffleArray(answers);
    shuffledAnswers.forEach(ansObj=>{
        const btn=document.createElement("button");
        btn.textContent=ansObj.text;
        btn.dataset.correct=ansObj.correct;
        btn.onclick=()=>checkAnswer(btn, ansObj.correct);
        answersContainer.appendChild(btn);
    });
    nextButton.style.display="none";
}

// Antwort prüfen
function checkAnswer(button,isCorrect){
    clearInterval(timer);
    const buttons = answersContainer.querySelectorAll("button");
    if(isCorrect){ button.classList.add("correct"); score += difficulty=="easy"?500: difficulty=="medium"?1000:1500; }
    else{ button.classList.add("wrong"); buttons.forEach(b=>{if(b.dataset.correct==="true") b.classList.add("correct");}); }
    buttons.forEach(b=>b.disabled=true);
    nextButton.style.display="inline-block";
}

function nextQuestion(){
    currentQuestion++;
    if(currentQuestion<questions.length){ showQuestion(); }
    else{ endQuiz(); }
}

// Quiz beenden
function endQuiz(){
    quizContainer.style.display="none";
    scoreBoard.style.display="block";
    document.getElementById("finalScore").textContent=score;
    loadServerLeaderboard();
}

// Highscore speichern
function saveScoreServer(){
    const name=document.getElementById("playerName").value||"Unbekannt";
    fetch("/submit-score",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({name:name,score:score})
    }).then(res=>res.json()).then(data=>showServerLeaderboard(data));
}

// Highscore abrufen
function loadServerLeaderboard(){
    fetch("/get-scores").then(res=>res.json()).then(data=>showServerLeaderboard(data));
}

function showServerLeaderboard(scores){
    const list=document.getElementById("leaderBoard");
    list.innerHTML="";
    scores.forEach(s=>{
        const li=document.createElement("li");
        li.textContent=`${s.name}: ${s.score} Punkte`;
        list.appendChild(li);
    });
}

function goBack(){ window.location.href="index.html"; }

// Array mischen
function shuffleArray(array){
    for(let i=array.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [array[i],array[j]]=[array[j],array[i]];
    }
    return array;
}
</script>
</body>
</html>